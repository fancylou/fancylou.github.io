---
layout: post
title: "Flutter å­¦ä¹ 3ï¼šè½¬åœºã€å¯¼èˆª"
categories: flutter
date: 2018-12-04 14:10:00
---

è¿™ä¸ªæ˜¯æˆ‘å­¦ä¹ Flutterçš„ä¸€ä¸ªç³»åˆ—æ–‡ç« ï¼š
1. [Flutter å­¦ä¹ 1ï¼šå¼€å‘ç¯å¢ƒã€å¼€å‘å·¥å…·ã€åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®](http://www.muliba.net/flutter/2018/11/16/Flutter-å­¦ä¹ -å¼€å‘ç¯å¢ƒ-å¼€å‘å·¥å…·-åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®.html)
2. [Flutter å­¦ä¹ 2ï¼šä»main.dartæ–‡ä»¶è¯´èµ·](http://www.muliba.net/flutter/2018/11/23/Flutter-%E5%AD%A6%E4%B9%A0-%E4%BB%8Emain.dart%E6%96%87%E4%BB%B6%E8%AF%B4%E8%B5%B7.html)
3. Flutter å­¦ä¹ 3ï¼šè½¬åœºã€å¯¼èˆª
4. [Flutter å­¦ä¹ 4ï¼šé›†æˆåˆ°åŸæœ‰çš„é¡¹ç›®ä¸­](http://www.muliba.net/flutter/2018/12/09/Flutter-%E5%AD%A6%E4%B9%A04-%E9%9B%86%E6%88%90%E5%88%B0%E5%8E%9F%E6%9C%89%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%B8%AD.html)
5. [Flutter å­¦ä¹ 5ï¼šå¼€å‘DartåŒ…å’Œæ’ä»¶åŒ…](http://www.muliba.net/flutter/2018/12/14/Flutter-%E5%AD%A6%E4%B9%A05-%E5%BC%80%E5%8F%91Dart%E5%8C%85%E5%92%8C%E6%8F%92%E4%BB%B6%E5%8C%85.html)
6. [Flutter å­¦ä¹ 6ï¼šç»˜åˆ¶åŠ¨ç”»](http://www.muliba.net/flutter/2018/12/28/Flutter-%E5%AD%A6%E4%B9%A06-%E7%BB%98%E5%88%B6%E5%8A%A8%E7%94%BB.html)
7. [Flutter å­¦ä¹ 7ï¼šDartè¯­è¨€åŸºç¡€](http://www.muliba.net/flutter/2018/01/11/Flutter-%E5%AD%A6%E4%B9%A07-Dart%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80.html)

ä¸Šæ¬¡æ–‡ç« ä»main.dartæ–‡ä»¶å¼€å§‹åˆ†æï¼Œå¹¶åšå‡ºæ¥ä¸€ä¸ªListViewçš„é¡µé¢ã€‚æˆ‘è·Ÿç€å®˜æ–¹çš„ä¾‹å­ç»§ç»­å¾€ä¸‹çœ‹ï¼Œå®ƒå†™äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œå½“å‰çš„åˆ—è¡¨æ•°æ®å¯ä»¥å¤šé€‰ï¼Œç„¶åå¯ä»¥è·³è½¬åˆ°ä¸€ä¸ªæ–°çš„é¡µé¢æŸ¥çœ‹é€‰ä¸­çš„å€¼ã€‚è¿™é‡Œå°±æ¶‰åŠåˆ°äº†é¡µé¢è·³è½¬ã€‚å…·ä½“æ¥çœ‹çœ‹æ€ä¹ˆåšã€‚

### ç¤ºä¾‹çš„é¡µé¢è·³è½¬

å‰é¢åˆ—è¡¨é¡µé¢å·²ç»å‡ºæ¥ï¼Œé‚£è¦å¤šé€‰éœ€è¦æŠŠé€‰ä¸­çš„æ•°æ®ä¿ç•™ä¸‹æ¥ã€‚

```dart
class RandomWordsState extends State<RandomWords> {
  final _suggestions = <WordPair>[];
  final _biggerFont = const TextStyle(fontSize: 18.0);
  final _saved = new Set<WordPair>(); //ä¿å­˜é€‰ä¸­çš„å€¼
  ...
  }
```

ç„¶ååˆ—è¡¨çš„Itemæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªçˆ±å¿ƒï¼Œç”¨æ¥è¡¨ç¤ºæ˜¯å¦é€‰ä¸­ã€‚è¿™é‡Œæˆ‘åˆè¦ğŸ‘ä¸€ä¸ªï¼ŒFlutterè‡ªå¸¦çš„Materialä¸»é¢˜æä¾›äº†å„ç§Iconï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ï¼Œéå¸¸æ–¹ä¾¿ï¼

```dart
Widget _buildItem(WordPair pair) {
    //è¿™é‡Œå®šä¹‰å½“å‰é¡¹æ˜¯å¦å·²ç»é€‰ä¸­
    final alreadySaved = _saved.contains(pair);
    return ListTile(
      title: Text(
        pair.asPascalCase,
        style: _biggerFont,
        ),
        //è¿™é‡Œå°±æ˜¯çˆ±å¿ƒå›¾æ ‡ï¼Œçº¢è‰²è¡¨ç¤ºé€‰ä¸­ï¼Œç©ºå¿ƒè¡¨ç¤ºæœªé€‰ä¸­
      trailing: Icon(
        alreadySaved ? Icons.favorite : Icons.favorite_border,
        color: alreadySaved ? Colors.red : null,
      ),
      //ListTileçš„ç‚¹å‡»äº‹ä»¶ é€‰ä¸­è¿˜æ˜¯å–æ¶ˆé€‰ä¸­
      onTap: (){
        setState(() {
                  if (alreadySaved) {
                    _saved.remove(pair);
                  }else {
                    _saved.add(pair);
                  } 
                });
      },
    );
  }
```

<!-- more -->

å°±æ˜¯åœ¨åŸæ¥çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†ä¸€ä¸ªçˆ±å¿ƒIconå’Œä¸€ä¸ªç‚¹å‡»äº‹ä»¶ã€‚ç°åœ¨å¯ä»¥ç‚¹å‡»äº†ã€‚

![](http://img.muliba.net/post/20181204144519.png-500.500)

ç„¶ååœ¨å¯¼èˆªæ æ·»åŠ ä¸€ä¸ªèœå•æŒ‰é’®ï¼Œç‚¹å‡»è·³è½¬åˆ°æ–°é¡µé¢æŸ¥çœ‹é€‰ä¸­çš„é‚£å‡ ä¸ªå€¼ã€‚

```dart
        appBar: new AppBar(
          title: new Text('Welcome to Flutter'),
          //æ·»åŠ èœå•æŒ‰é’®
          actions: <Widget>[
            new IconButton(icon: const Icon(Icons.list), onPressed: _navigatePush)
          ],
        ),
```

`IconButton`ç»‘å®šäº†ç‚¹å‡»äº‹ä»¶`_navigatePush` è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚

```dart
void _navigatePush() {
    ...
}
```

é‡ç‚¹æ¥äº†ï¼Œè¿™ä¸ªå‡½æ•°é‡Œé¢åº”è¯¥æ˜¯è·³è½¬é¡µé¢çš„ä»£ç ï¼Œå¦‚ä½•å†™çš„å‘¢ï¼Ÿ å®˜æ–¹çš„ä¾‹å­æ˜¯è¿™æ ·å†™çš„ï¼š

```dart
    //è¿™å¥æ˜¯é‡ç‚¹è·³è½¬åˆ°ä¸€ä¸ªæ–°é¡µé¢ã€‚é€šè¿‡ä¸€ä¸ªMaterialPageRouteå¯¹è±¡è¿›è¡Œçš„
    Navigator.of(context).push(
      new MaterialPageRoute<void>(
        builder: (BuildContext context) {
          final tiles = _saved.map((WordPair pair){
            return new ListTile(
              title: new Text(pair.asPascalCase, style:_biggerFont),
            );
          });
          final divided = ListTile.divideTiles(context: context, tiles: tiles).toList();
          return new Scaffold(         
            appBar: new AppBar(
              title: const Text('Saved Suggestions'),
            ),
            body: new ListView(children: divided),
          ); 
        }
      )
    );
```
ç°åœ¨ç‚¹å‡»å³ä¸Šè§’çš„åˆ—è¡¨å›¾æ ‡çš„èœå•æŒ‰é’®å°±ä¼šè·³è½¬ä¸€ä¸‹ï¼Œç„¶åå±•ç°é€‰ä¸­çš„å€¼ã€‚

![](http://img.muliba.net/post/20181204150019.png-500.500)

è¿™ä¸ªä¾‹å­å®ƒæŠŠæ–°é¡µé¢çš„ä»£ç éƒ½å†™åœ¨äº†è¿™ä¸ªMaterialPageRouteçš„builderå‡½æ•°é‡Œé¢äº†ã€‚å¯¹äºç®€å•ä¸šåŠ¡çš„é¡µé¢è¿™æ ·å†™è¿˜æ˜¯è›®æ–¹ä¾¿çš„ï¼ä½†è¿™ç§æ—¶å€™æ¯•ç«Ÿå°‘ï¼Œå¤§éƒ¨åˆ†æƒ…å†µæ˜¯é¡µé¢ç»“æ„å¤æ‚ï¼Œé€»è¾‘å¤æ‚ï¼Œè‚¯å®šæ˜¯è¦ä¸“é—¨ä¸€ä¸ªåˆ†å¼€çš„ç±»æ¥å¤„ç†çš„ã€‚é‚£è¿™ç§æƒ…å†µæ€ä¹ˆè·³è½¬å‘¢ï¼Ÿ

### çœŸå®çš„é¡µé¢è·³è½¬

æŸ¥è¯¢äº†å®˜æ–¹æ–‡æ¡£åï¼Œå‘ç°è·³è½¬åˆ°ä¸€ä¸ªæ–°çš„é¡µé¢ä»£ç ä¹Ÿå¾ˆç®€å•ï¼Œè·Ÿä¸Šé¢çš„ç±»ä¼¼ï¼š

```dart
Navigator.push(
    context,
    MaterialPageRoute(builder: (context) => SecondScreen()),
  );
```
é‚£å‰é¢çš„ä¾‹å­æœ‰æŠŠé€‰ä¸­çš„æ•°æ®ä¼ é€’è¿‡å»çš„ï¼Œå‰é¢æ˜¯å› ä¸ºéƒ½åœ¨classå†…éƒ¨çš„æ‰€ä»¥ç›´æ¥ç”¨`_saved`è¿™ä¸ªSetå°±è¡Œäº†ã€‚é‚£ç°åœ¨classåˆ†å¼€äº†å¦‚ä½•ä¼ é€’å‘¢ï¼Ÿ æ”¹å†™ä¸‹è¿™ä¸ªSecondScreençš„æ„å»ºå‡½æ•°ã€‚

```dart
class SecondScreen extends StatelessWidget {
  final Set<WordPair> saved ;

 // å¿…é¡»ä¼ å…¥ä¸€ä¸ªSetç”¨æ¥å±•ç°æ•°æ®ã€‚
  SecondScreen({Key key, @required this.saved}) : super(key: key);
  ...
```

è·³è½¬çš„æ—¶å€™å°±æŠŠ`_saved`è¿™ä¸ªSetä¼ è¿›å»å°±è¡Œäº†ã€‚

```dart
Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => SecondScreen(saved: _saved)
      )
    );
```

### é¡µé¢å…³é—­è¿”å›æ•°æ®

ç°åœ¨é¡µé¢è·³è½¬æœ‰äº†ï¼Œæœ‰è·³è½¬æœ‰ä¼ å…¥æ•°æ®ï¼Œé‚£å¾ˆå®¹æ˜“è”æƒ³åˆ°ä¼ å‡ºæ•°æ®ï¼Œå°±æ˜¯æŠŠæ•°æ®è¿”å›ç»™å‰é¢çš„é‚£ä¸ªé¡µé¢ã€‚
è¿˜æ˜¯åœ¨è¿™ä¸ªDemoçš„åŸºç¡€ä¸Šç»§ç»­ï¼Œæ¯”å¦‚æˆ‘ä»¬ç¬¬äºŒä¸ªé¡µé¢ä¹Ÿæ˜¯ListViewï¼Œç‚¹å‡»æŸä¸€é¡¹æŠŠæ•°æ®è¿”å›ç»™å‰é¢é‚£ä¸ªé¡µé¢ã€‚
å…ˆåŠ ç‚¹å‡»äº‹ä»¶ï¼š

```dart
        return new ListTile(
              title: new Text(pair.asPascalCase, style:_biggerFont),
              onTap: (){
                  _itemTapAndNavigationPop(context, pair.asPascalCase);
              },
            );
```
ç‚¹å‡»ä¹‹åæŠŠåå­—ä¼ å‡ºå»ï¼Œå¹¶ä¸”å…³é—­å½“å‰é¡µé¢ï¼š

```dart
void _itemTapAndNavigationPop(BuildContext context, String title) {
    //åªè¦æ‰§è¡Œpopå‡½æ•°å°±è¡Œäº†ã€‚
    Navigator.pop(context, title);
  }
```

ä½†æ˜¯å‰é¢çš„é¡µé¢éœ€è¦æ¥æ”¶è¿”å›çš„æ•°æ®å•Šï¼Œè·³è½¬çš„æ—¶å€™å°±è‚¯å®šä¸æ˜¯åŸæ¥çš„å†™æ³•äº†ï¼š

```dart
//è¿™é‡Œè¿™ä¸ªè°ƒç”¨å‡½æ•°åŠ äº†å¼‚æ­¥æ ‡è¯†async
void _navigatePush(BuildContext context) async {
    //é¡µé¢è¿”å›çš„æ•°æ®result
    final result = await Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => SecondScreen(saved: _saved)
      )
    );
    if (result != null) {
      //æŠŠæ¥æ”¶åˆ°çš„å€¼ ç”¨SnackBaræ˜¾ç¤ºä¸€ä¸‹
      Scaffold.of(context).showSnackBar(SnackBar(content: Text("$result")));
    }else {
      debugPrint('æ²¡æœ‰å›ä¼ æ•°æ®ï¼ï¼ï¼ï¼');
    }
  }
```

è¿™é‡Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œè¿”å›æ•°æ®çš„æ—¶å€™showSnackBarè¿™é‡Œä¸€ç›´æŠ¥é”™ï¼çœ‹æ–‡æ¡£çš„æ„æ€æ˜¯å½“BuildContextåœ¨Scaffoldä¹‹å‰è°ƒç”¨Scaffold.of(context)ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨Scaffoldçš„åŸºç¡€ä¸Šæ˜¾ç¤ºçš„ã€‚æ‰€ä»¥å®ƒå»ºè®®è¦æ–°å»ºä¸€ä¸ªBuilderã€‚æ‰€ä»¥å‰é¢çš„åˆ—è¡¨èœå•æŒ‰é’®å°±é‡æ–°Builderæ„å»ºäº†ä¸€æ¬¡ã€‚

```dart
    actions: <Widget>[
            new Builder(builder: (BuildContext context){
                return IconButton(
                  icon: const Icon(Icons.list), 
                  onPressed: () => this._navigatePush(context)  
                );
            })
          ],
```


é¡µé¢è·³è½¬ï¼Œæ•°æ®ä¼ é€’åŸºæœ¬å°±è¿™æ ·ï¼Œè·ŸåŸç”Ÿçš„å·²ç»å¾ˆç±»ä¼¼äº†ï¼
å…¨éƒ¨ä»£ç ï¼š[https://github.com/fancylou/FlutterDemo/tree/2018-12-04](https://github.com/fancylou/FlutterDemo/tree/2018-12-04)

The End ï¼