---
layout: post
title: "flutteræ•°æ®ç›‘å¬å™¨"
categories: flutter
date: 2019-06-14 15:00:00
---

æœ€è¿‘ç”¨FlutteråšåŠŸèƒ½çš„æ—¶å€™ï¼Œå‘ç°äº†è¿™ä¹ˆä¸€ä¸ªæ§ä»¶`ValueListenableBuilder`ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªWidgetï¼Œä»å®ƒçš„åå­—çœ‹åº”è¯¥æ˜¯ç›‘å¬æ•°æ®ï¼Œå¹¶ä¸”ç”¨æ–°çš„æ•°æ®ç”ŸæˆWidgetï¼Œå®ƒçš„å‚æ•°å°±ä¸‰ä¸ªï¼š

```dart
const ValueListenableBuilder({
    @required this.valueListenable,
    @required this.builder,
    this.child,
  }) 
```

### å‚æ•°è¯´æ˜
* **valueListenable** æ•°æ®ç›‘å¬ï¼Œå®˜æ–¹è¯´æ˜ï¼šThis interface is implemented by [ValueNotifier<T>] and [Animation<T>]ï¼Œæ‰€ä»¥å®ƒä¸ä»…å¯ä»¥æ˜¯ValueNotifierï¼Œè¿˜å¯ä»¥æ˜¯Animationã€‚
* **builder** æ ¹æ®ä¸Šé¢çš„ç›‘å¬å™¨é‡æ–°ç»˜åˆ¶Widgetã€‚
* **child** è¿™ä¸ªchildä¼šä½œä¸ºå‚æ•°ä¼ å…¥ä¸Šé¢çš„é‚£ä¸ªbuilderæ–¹æ³•ä¸­ï¼Œå®ƒå¹²å•¥ç”¨å‘¢ã€‚å¯èƒ½ValueListenableBuilderç”Ÿæˆçš„Widgetä¸­æœ‰ä¸€äº›å­å…ƒç´ è·Ÿä¸Šé¢ç›‘å¬çš„æ•°æ®æ²¡æœ‰å…³ç³»ï¼Œä¸éœ€è¦é‡æ–°ç»˜åˆ¶ã€‚


### ç¤ºä¾‹
ä»ä¸Šé¢é‚£äº›è¯´æ˜çœ‹æ¥è¿™ä¸ªæ§ä»¶çš„ä½œç”¨å°±æ˜¯ä½œä¸ºå±€éƒ¨åˆ·æ–°ç”¨çš„ï¼Œå¯èƒ½æˆ‘ä»¬æ•´ä¸ªé¡µé¢ä¸Šåªæ˜¯ä¸€ä¸ªå°å‚æ•°å˜åŒ–äº†ï¼Œé‚£æœ‰äº†è¿™ä¸ªWidgetå°±ä¸éœ€è¦ç”¨`setState(() {});`æ¥åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚

åšä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè¿™ä¸ªç¤ºä¾‹æ˜¯flutteré»˜è®¤ç”Ÿæˆçš„é¡¹ç›®æ”¹å†™çš„ï¼š

```dart
class _MyHomePageState extends State<MyHomePage> {
  int _counter = 0;
  final ValueNotifier<int> _notifier = ValueNotifier<int>(0);

  void _incrementCounter() {
    _counter++;
    _notifier.value++;
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            ValueListenableBuilder(
                valueListenable: _notifier,
                builder: (BuildContext context, int value, Widget child) {
                  return Text(
                    'You have pushed the button this many times:$value',
                  );
                }),
            Text(
              '$_counter',
              style: Theme.of(context).textTheme.display1,
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: 'Increment',
        child: Icon(Icons.add),
      ), 
   );
  }
}
```
![20190614-1.2019-06-14 15_36_31](http://img.muliba.net/2019-06-14-20190614-1.2019-06-14%2015_36_31.gif)









<!-- more -->



`_incrementCounter`å‡½æ•°çš„ä»£ç ï¼Œåœ¨ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œæ²¡æœ‰æ‰§è¡Œ`setState(() {});`ï¼Œä½†æ˜¯`ValueListenableBuilder`å†…çš„Textçš„æ•°å­—å´å˜åŒ–äº†ï¼Œè€ŒåŸæ¥çš„å¤–é¢çš„é‚£ä¸ªTextä¸Šçš„æ•°å­—æ²¡æœ‰å˜åŒ–ã€‚

### ç¤ºä¾‹2

ä¸Šé¢çš„ä¾‹å­ç›‘å¬äº†ä¸€ä¸ªintç±»å‹ï¼Œè¿™æ¬¡ç”¨ä¸€ä¸ªå¤æ‚å¯¹è±¡ï¼Œé¡ºä¾¿è¯•è¯•ä¸€ä¸‹`child`å‚æ•°ã€‚
å…ˆçœ‹å›¾ï¼š


![20190614-2.2019-06-14 16_04_03](http://img.muliba.net/2019-06-14-20190614-2.2019-06-14%2016_04_03.gif)



å¤æ‚å¯¹è±¡ğŸ˜„ï¼š

```dart
class ComplicatedObject {
  int number;
  String title;

  ComplicatedObject({this.number, this.title});
}
```


ç¤ºä¾‹ä»£ç ï¼š

```dart
class _MyHomePageState extends State<MyHomePage> {
  final ValueNotifier<ComplicatedObject> _notifier =
      ValueNotifier<ComplicatedObject>(
          ComplicatedObject(number: 0, title: 'æ ‡é¢˜'));
  //ä¸­é—´ä¸å˜çš„å†…å®¹
  Widget _content;

  void _incrementCounter() {
    _notifier.value = ComplicatedObject(number: 1024, title: 'æ–°æ ‡é¢˜');
  }

  @override
  void initState() {
    _content = Center(
        child: Text(
      'è¿™é‡Œæ˜¯å†…å®¹ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚',
    ));
    super.initState();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: ValueListenableBuilder(
        valueListenable: _notifier,
        builder: (BuildContext context, ComplicatedObject value, Widget child) {
          return Column(
            children: <Widget>[
              Container(
                height: 48,
                child: Text('${value.title}',
                    style: Theme.of(context).textTheme.display1),
              ),
              Expanded(
                child: child,
                flex: 1,
              ),
              Container(
                height: 48,
                child: Text('${value.number}',
                    style: Theme.of(context).textTheme.caption),
              ),
            ],
          );
        },
        child: _content,//è¿™é‡Œæ˜¯ä¼ å…¥ä¸Šé¢ç”Ÿæˆå¥½çš„ä¸å˜çš„Widget
      ),

      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: 'Increment',
        child: Icon(Icons.add),
      ),
    );
  }
}
```

### è‡ªå®šä¹‰ç›‘å¬å¯¹è±¡å±æ€§
æ—¢ç„¶å¤æ‚å¯¹è±¡å¯ä»¥ç›‘å¬ï¼Œé‚£è‚¯å®šæœ‰äº›éœ€æ±‚è¯´æ˜¯æˆ‘åªæƒ³ç›‘å¬è¿™ä¸ªå¯¹è±¡ä¸­çš„æŸäº›å±æ€§æ€ä¹ˆåŠï¼Œè¿™å¯ä»¥é€šè¿‡é‡å†™ValueNotifierå¯¹è±¡å®ç°ï¼š

```dart
class ComplicatedObjectNotifier extends ValueNotifier<ComplicatedObject> {
  
  ComplicatedObjectNotifier(ComplicatedObject object): super(object);

  void setTitle(String newTitle) {
    value.title = newTitle;
    //è¿™å¥æ˜¯å…³é”® ä¸€å®šè¦å†™ã€‚
    notifyListeners();
  } 

}
```

æœ‰äº†è¿™ä¸ªé‡å†™çš„ç±»ï¼ŒæŠŠåŸæ¥ä»£ç ä¸­çš„ValueNotifieræ›¿æ¢æ‰ï¼š

```dart
class _MyHomePageState extends State<MyHomePage> {
  final ComplicatedObjectNotifier _notifier =
      ComplicatedObjectNotifier(
          ComplicatedObject(number: 0, title: 'æ ‡é¢˜'));
  //ä¸­é—´ä¸å˜çš„å†…å®¹
  Widget _content;

  void _incrementCounter() {
    _notifier.setTitle('åˆæ˜¯æ–°æ ‡é¢˜');
  }

  @override
  void initState() {
    _content = Center(
        child: Text(
      'è¿™é‡Œæ˜¯å†…å®¹ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚',
    ));
    super.initState();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: ValueListenableBuilder(
        valueListenable: _notifier,
        builder: (BuildContext context, ComplicatedObject value, Widget child) {
          return Column(
            children: <Widget>[
              Container(
                height: 48,
                child: Text('${value.title}',
                    style: Theme.of(context).textTheme.display1),
              ),
              Expanded(
                child: child,
                flex: 1,
              ),
              Container(
                height: 48,
                child: Text('${value.number}',
                    style: Theme.of(context).textTheme.caption),
              ),
            ],
          );
        },
        child: _content,//è¿™é‡Œæ˜¯ä¼ å…¥ä¸Šé¢ç”Ÿæˆå¥½çš„ä¸å˜çš„Widget
      ),

      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: 'Increment',
        child: Icon(Icons.add),
      ),
    );
  }
}
```

ç»“æœå°±æ˜¯è¿™æ ·äº†ï¼š
![20190614-3.2019-06-14 16_19_11](http://img.muliba.net/2019-06-14-20190614-3.2019-06-14%2016_19_11.gif)





è¿˜æ˜¯é‚£å¥è€è¯Flutterç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šå¥½ç©å¥½çœ‹åˆå¥½ç”¨çš„Widgetï¼Œå¯¹äºä¸€ä¸ªå¼€å‘è€…è€Œè¨€ï¼ŒçœŸæ˜¯å¤ªå‹å¥½äº†ï¼





The End ï¼