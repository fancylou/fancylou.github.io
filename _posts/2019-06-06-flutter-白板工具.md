---
layout: post
title: "flutter ç™½æ¿å·¥å…·"
categories: flutter
date: 2019-06-06 10:00:00
---

å¹³å¸¸æ¡Œé¢ä¸Šéƒ½æ”¾ç€ä¸€äº›è‰ç¨¿çº¸ï¼Œå› ä¸ºç»å¸¸è¦æ•´ç†æ€è·¯ã€ç”»ç”»è‰å›¾å•¥çš„ã€‚è¿™ä¸æ˜¯ç”µå­æ—¶ä»£å˜›ï¼Œå°±è§‰å¾—åœ¨æ‰‹æœºã€padä¸Šä¹Ÿå¯ä»¥è¿™æ ·å†™å†™ç”»ç”»ï¼Œæˆ‘çœ‹äº†æœ‰å¾ˆå¤šè¿™ç§ç±»ä¼¼çš„appï¼ŒåŠŸèƒ½å¾ˆç®€å•å°±ä¸€ä¸ªç™½æ¿ï¼Œç›´æ¥å°±å¯ä»¥ç”»ï¼Œå·¥å…·æ å¤§æ¦‚åŒ…æ‹¬é€‰ç”»ç¬”é¢œè‰²ã€é€‰ç¬”å°–å¤§å°ã€é€‰æ©¡çš®æ“¦ç­‰ã€‚

äºæ˜¯æˆ‘ç”¨Flutterç®€å•å®ç°äº†ä¸€ä¸ªï¼Œæ•ˆæœçœ‹ä¸‹å›¾ï¼Œå¯ä»¥é€‰é¢œè‰²å’Œç¬”å°–å¤§å°ï¼š
![20190606-whiteboard.2019-06-06 09_48_24](http://img.muliba.net/2019-06-06-20190606-whiteboard.2019-06-06%2009_48_24.gif)



## ä¸»è¦æ€è·¯
æ•´ä½“çœ‹è¿™ä¸ªåŠŸèƒ½å®ç°ä¸éš¾ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ™®é€šç”»æ¿ï¼Œç”»æ¿æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª`CustomPainter`æ¥åšï¼Œå…³äº`CustomPainter`æˆ‘å‰é¢æœ‰æ–‡ç« æœ‰ä»‹ç»è¿‡[ã€ŠFlutter å­¦ä¹ 6ï¼šç»˜åˆ¶åŠ¨ç”»ã€‹](http://www.muliba.net/flutter/2018/12/28/Flutter-%E5%AD%A6%E4%B9%A06-%E7%BB%98%E5%88%B6%E5%8A%A8%E7%94%BB.html)  ã€‚

`CustomPainter` æ ¹æ®æ‹–åŠ¨æ‰‹åŠ¿ï¼ŒæŠŠæ‰‹æŒ‡æ»‘åŠ¨è¿‡çš„åæ ‡ç”»å‡ºæ¥ï¼Œå…¶å®å°±æ˜¯æŠŠç‚¹è¿æˆçº¿ï¼Œå¹¶ä¸”å¾—çŸ¥é“å½“æ—¶çš„ç”»ç¬”é¢œè‰²å’Œå¤§å°ã€‚

é‚£æ‹–åŠ¨æ‰‹åŠ¿å½“ç„¶ç”¨`GestureDetector`å•¦ï¼Œæ‹–åŠ¨çš„æ—¶å€™ç”¨`onPanUpdate`äº‹ä»¶æ¥è·å–åæ ‡å¹¶ä¸”æŠŠåæ ‡è¿æˆçº¿ï¼Œæ¯æ¬¡ç»˜ç”»ç»“æŸå°±ç”¨æ‹–åŠ¨ç»“æŸäº‹ä»¶æ¥å¤„ç†`onPanEnd` ã€‚

<!-- more -->

## å…·ä½“å®ç°
Flutterä¸€ç›´åœ¨ä¸»æ¨ä»–çš„`Material`ä¸»é¢˜ï¼Œè·ŸGoogleä»–ä»¬è‡ªå·±çš„Androidéå¸¸ä¸€è‡´ï¼Œè¿™ä¸ªä¸»é¢˜è¿˜æä¾›äº†å¾ˆå¤šWidgetï¼Œç»™å¼€å‘Appæä¾›äº†å¾ˆå¤šä¾¿åˆ©ã€‚ä½†æ˜¯Flutterå®˜æ–¹å…¶å®è¿˜æœ‰ä¸€ä¸ªIOSçš„ä¸»é¢˜`cupertino`ï¼Œè¿™æ¬¡æˆ‘å°±è¯•ç€ç”¨è¿™ä¸ª`cupertino`ä¸»é¢˜å¼€å‘è¿™ä¸ªç™½æ¿å·¥å…·ã€‚
### cupertinoä¸»é¢˜
ä¸»é¢˜ç”¨æ³•è·Ÿ`Material`ä¸€æ ·ï¼Œ`MaterialApp`å¯¹åº”è¿™é‡Œç”¨`CupertinoApp`ï¼Œ`Scaffold`å¯¹åº”è¿™é‡Œç”¨`CupertinoPageScaffold`ã€‚å½“ç„¶è¿˜æœ‰å¾ˆå¤šæ¯”å¦‚`CupertinoThemeData`ã€`CupertinoNavigationBar`ã€`CupertinoDialog`ç­‰ç­‰ï¼Œä½†æ˜¯æ¯”èµ·`Material`ä¸»é¢˜è¿™é‡Œçš„Widgetè¦å°‘çš„å¤šäº†ã€‚

* CupertinoNavigationBar

![cupertino-nav-ba-w320](http://img.muliba.net/2019-06-06-cupertino-nav-bar.png)
* CupertinoAlertDialog

![cupertino-alert-dialog-w300](http://img.muliba.net/2019-06-06-cupertino-alert-dialog.png)
* CupertinoActionSheet

![cupertino-action-sheet-w273](http://img.muliba.net/2019-06-06-cupertino-action-sheet.png)
* CupertinoPicker

![cupertino-date-picke-w258](http://img.muliba.net/2019-06-06-cupertino-date-picker.png)
* CupertinoSegmentedControl

![cupertino-segmented-contro](http://img.muliba.net/2019-06-06-cupertino-segmented-control.png)


### CustomPainter
å‰é¢æ€è·¯ä¸­è¯´è¿‡è¿™é‡Œä¸»è¦æ˜¯ç”»çº¿ï¼Œä½†æ˜¯å› ä¸ºçº¿æ¡é¢œè‰²ã€å®½åº¦æœ‰å˜åŒ–ï¼Œæ‰€ä»¥å¿…é¡»çš„è®°å½•ä¸‹å½“æ—¶çš„é¢œè‰²å’Œå¤§å°ã€‚äºæ˜¯æˆ‘å†™äº†ä¸€ä¸ªå®ä½“ç±»æ¥ä¿å­˜è¿™äº›æ•°æ®ï¼š

```dart
 class WPPainter {
  Offset point;
  Color color;
  double strokeWidth;
  WPPainter(this.point, this.color, this.strokeWidth);
}
```
ç„¶å`CustomPainter`å¤„ç†ç»˜ç”»å°±ç®€å•äº†ï¼š

```dart
final List<WPPainter> points;

  @override
  void paint(Canvas canvas, Size size) {
    Paint paint = new Paint()..strokeCap = StrokeCap.round;
    for (var i = 0; i < points.length - 1; i++) {
    //nullæ˜¯çº¿æ¡ç»“æŸæ ‡å¿—
      if (points[i] != null && points[i + 1] != null) {
        var wp = points[i];
        var nextWp = points[i + 1];
        paint.color = wp.color;
        paint.strokeWidth = wp.strokeWidth;
        canvas.drawLine(wp.point, nextWp.point, paint);
      }
    }
  }

  @override
  bool shouldRepaint(_MyPainter oldDelegate) {
    return oldDelegate.points != this.points;
  }
```
ä¸Šé¢ä»£ç æ³¨é‡Šè¯´çš„çº¿æ¡ç»“æŸæ ‡å¿—å°±æ˜¯å‰é¢æ€è·¯ä¸­ä»‹ç»çš„`onPanEnd`çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨pointsä¸­æ·»åŠ ä¸€ä¸ªnullï¼Œè¿™æ ·å°±ä¸ä¼šæŠŠæ‰€æœ‰çš„çº¿éƒ½è¿èµ·æ¥äº†ã€‚

æ·»åŠ æ‹–åŠ¨äº‹ä»¶ï¼š

```dart
onPanUpdate: (detail) {
//è®¡ç®—åæ ‡
    RenderBox referenceBox = context.findRenderObject();
    Offset localPosition =
        referenceBox.globalToLocal(detail.globalPosition);

    setState(() {
    //æ·»åŠ åæ ‡
      _points.add(WPPainter(
            localPosition, _paintColor, _paintStokeWidth));
    });
},
//ç»“æŸæ ‡è®°
onPanEnd: (detail) => _points.add(null),
```
### colorPickeré¢œè‰²é€‰æ‹©å™¨
é¢œè‰²é€‰æ‹©å™¨æˆ‘è¿™é‡Œæ˜¯å¼¹å‡ºä¸€ä¸ªDialogï¼Œè·ŸåŸæ¥Materialä¸»é¢˜ä¸‹ä¸€æ ·ï¼Œè¿™é‡Œä¹Ÿæä¾›äº†showDialogçš„æ–¹æ³•ï¼Œä¸è¿‡å«åšï¼š`showCupertinoDialog`

```dart
showCupertinoDialog(
    context: context,
    builder: (_) {
      return CupertinoAlertDialog(
        title: Text("é€‰æ‹©é¢œè‰²"),
        content: ColorChooseWidget((color) {
          _tempChooseColor = color;
        }, selectedColor),
        actions: <Widget>[
          CupertinoDialogAction(
            child: Text('å–æ¶ˆ'),
            onPressed: () {
              Navigator.of(context).pop();
            },
          ),
          CupertinoDialogAction(
            child: Text('ç¡®å®š'),
            isDefaultAction: true,
            onPressed: () {
              chooseColor(_tempChooseColor);
              Navigator.of(context).pop();
            },
          )
        ],
      );
    },
  );
```

å¼¹å‡ºçš„Dialogå†…å®¹`ColorChooseWidget`å°±æ˜¯ä¸€ä¸ª`GridView` ã€‚è¿™é‡Œçš„GridViewæˆ‘æœ¬æ¥æƒ³æ ¹æ®å±å¹•å¤§å°æ§åˆ¶Dialogå®½åº¦ï¼Œç„¶åæ ¹æ®å®½åº¦è®¡ç®—`GridView`çš„`crossAxisCount`å°±æ˜¯ä¸€è¡Œæ”¾å‡ ä¸ªé¢œè‰²ã€‚ä½†æ˜¯åæ¥å‘ç°åŸæ¥CupertinoAlertDialogçš„å®½åº¦æ˜¯å›ºå®šæ­»çš„270 ğŸ˜“ æ‰€ä»¥è¿™é‡Œå°±åªèƒ½å†™æ­»äº†ã€‚

```dart
 @override
  Widget build(BuildContext context) {
    final Size size = MediaQuery.of(context).size ;
    // 270 æ˜¯ CupertinoAlertDialog å›ºå®šçš„å®½åº¦
    final int crossCount = ((270 - _kContainerPadding * 2) / (_kCircleColorSize + _kPadding)).floor();
    final int row = (materialColors.length / crossCount).floor();
    double height = (_kCircleColorSize + _kPadding) * row + _kContainerPadding * 2;
    if (height > size.height * 0.7 ) {
      height = size.height * .7;
    }
    return Container(
        width: 270,
        height: height,
        child: GridView.count(
          padding: const EdgeInsets.all(_kContainerPadding),
          crossAxisSpacing: _kPadding,
          mainAxisSpacing: _kPadding,
          crossAxisCount: crossCount,
          childAspectRatio: 1.0,
          children: _buildListColorForGridView(),
        ));
  }
```




### ç¬”å°–å¤§å°
ç¬”å°–å¤§å°å°±å¾ˆç®€å•äº†ï¼Œç”»å‡ ä¸ªåœˆï¼Œé€‰ä¸­çš„è¯åœˆçš„çº¿æ¡ç²—ä¸€ç‚¹ï¼š

```dart
Container(
      width: size,
      height: size,
      decoration: ShapeDecoration(
          shape:
              CircleBorder(side: BorderSide(width: isChecked ? 4.0 : 1.0))
      ),
    )
```

PSï¼š
æ©¡çš®æ“¦å·¥å…·ï¼Œæˆ‘è§‰å¾—å°±æ˜¯æŠŠç”»ç¬”é¢œè‰²è°ƒæˆç™½è‰²å°±å¥½äº†ã€‚
æœ€åå¥½åƒè¿˜æœ‰ä¸ªå±å¹•æ—‹è½¬çš„é—®é¢˜æ²¡æœ‰è§£å†³ï¼Œä»¥åå†çœ‹çœ‹å§ï¼
æƒ¯ä¾‹ï¼Œæ‰€æœ‰æºç æˆ‘éƒ½æ”¾åœ¨GitHubä¸Šäº†ã€‚[https://github.com/fancylou/white_board](https://github.com/fancylou/white_board)